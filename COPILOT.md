# COPILOT

## 基本ルール

- 回答は日本語で行う
- 生成コードにはコメントを含めない。ただし、既存のコメントは削除せず維持する
- 記述量が減る、可読性が向上する、性能が向上する、などのメリットが無く、結果も変化しない冗長な提案をしない

## 禁止事項

- 修正のたびに新しいlinterエラーを発生させない
- 一度に複数のlinterルールを破らない

## linterルール

### 主要設定

- 関数の長さは60行以内（funlen）
- 行長は180文字以内（lll）
- エラーハンドリングは `errors.WithStack()` を使用
- 共通化可能なコードは積極的に関数化する

### wsl (whitespace linter)

- 変数宣言（`:=`, `var`）後は空行必須
- return文前は空行必須
- for/if/switchの前は基本的に空行不要
- ただし、直前が変数宣言や代入の場合は空行を入れる
- case/defaultの前後は空行不要
- 関数の開始・終了直後は空行不要

### 対処法

- `funlen`: 関数が長すぎる → 共通部品を抽出
- `lll`: 行が長すぎる → 関数シグネチャを複数行に分割
- `wsl`: 空行ルール違反 → 上記ルールに従って空行調整
- `nlreturn`: return前空行なし → return前に空行追加

## testルール

- テスト関数名は `Test` + 機能名
- テーブルドリブンテストを使用
- `testify/assert` を使用
- `testify/require` を使用
  - エラーを返す関数のテストでは `require.NoError()`, `require.Error()` を適切に使用
- 副作用が無い限り、テスト関数の冒頭と `t.Run()` 冒頭で `t.Parallel()` を使用
- モックは `_mock.go` ファイルに分離
- テストファイルは `_test.go` 拡張子

## 開発フロー

- 修正前に既存のlinterエラーを把握する
- 修正後は複数のlinterルールを同時に満たす
- コンテキストウィンドウの制限を考慮し、要点を明確にする
