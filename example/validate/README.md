# Validation Integration Example

This example demonstrates seamless integration with go-playground/validator for robust field validation.

## Files

- `account.go` - Struct definition with validation tags
- `account_prop.go` - Generated property methods with validation (auto-generated)
- `../cmd/example/validate/main.go` - Usage example

## Features Demonstrated

- go-playground/validator integration
- Constructor generation with validation (`-new-func`)
- Custom validation function (`-validation-func`)
- Private setters with validation
- Comprehensive error handling

## Struct Definition

```go
package example

import (
    "fmt"
    "github.com/go-playground/validator/v10"
)

var validate = validator.New()

// Account represents a user account with validation.
type Account struct {
    id       int    `property:"get"`                                                   // Read-only ID field
    username string `property:"get,set" validate:"required,min=3,max=20"`             // Username with length validation
    email    string `property:"get,set" validate:"required,email"`                    // Email with format validation
    password string `property:"set=private" validate:"required,min=8,containsany=!@#$"` // Password with length and special character validation
}

// validateField validates field values using go-playground/validator.
func validateField(fieldName string, value any, rule string) error {
    if err := validate.Var(value, rule); err != nil {
        return fmt.Errorf("validation failed for field '%s': %s", fieldName, err.Error())
    }
    return nil
}
```

## Code Generation

```bash
go tool genprop -new-func -validation-func="validateField" -validation-tag="validate" account.go > account_prop.go
```

## Generated Output

```go
// Code generated by github.com/hidori/go-genprop/cmd/genprop DO NOT EDIT.
package example

func NewAccount(id int, username string, email string, password string) (*Account, error) {
    s := &Account{}
    s.id = id
    err := s.SetUsername(username)
    if err != nil {
        return nil, err
    }
    err = s.SetEmail(email)
    if err != nil {
        return nil, err
    }
    err = s.setPassword(password)
    if err != nil {
        return nil, err
    }
    return s, nil
}
func (t *Account) GetID() int {
    return t.id
}
func (t *Account) GetUsername() string {
    return t.username
}
func (t *Account) SetUsername(v string) error {
    err := validateField("username", v, "required,min=3,max=20")
    if err != nil {
        return err
    }
    t.username = v
    return nil
}
func (t *Account) GetEmail() string {
    return t.email
}
func (t *Account) SetEmail(v string) error {
    err := validateField("email", v, "required,email")
    if err != nil {
        return err
    }
    t.email = v
    return nil
}
func (t *Account) setPassword(v string) error {
    err := validateField("password", v, "required,min=8,containsany=!@#$")
    if err != nil {
        return err
    }
    t.password = v
    return nil
}
```

## Usage Example

```go
// Create a new account using the generated New function with validation
account, err := example.NewAccount(1, "john_doe", "john@example.com", "SecurePass123!")
if err != nil {
    log.Fatal("Failed to create account:", err)
}

// Access values using getters
fmt.Printf("Account ID: %d\n", account.GetID())         // Output: Account ID: 1
fmt.Printf("Username: %s\n", account.GetUsername())     // Output: Username: john_doe
fmt.Printf("Email: %s\n", account.GetEmail())           // Output: Email: john@example.com

// Update values using setters with validation
err = account.SetUsername("jane_smith")
if err != nil {
    fmt.Printf("Username update failed: %v\n", err)
} else {
    fmt.Printf("Updated Username: %s\n", account.GetUsername()) // Output: Updated Username: jane_smith
}

// Test validation failures
err = account.SetUsername("ab") // Too short
if err != nil {
    fmt.Printf("Expected validation error: %v\n", err)
    // Output: Expected validation error: validation failed for field 'username': Key: '' Error:Field validation for '' failed on the 'min' tag
}

err = account.SetEmail("invalid-email") // Invalid format
if err != nil {
    fmt.Printf("Expected validation error: %v\n", err)
    // Output: Expected validation error: validation failed for field 'email': Key: '' Error:Field validation for '' failed on the 'email' tag
}
```

## Validation Rules

- **Username**: `required,min=3,max=20` - Required, 3-20 characters
- **Email**: `required,email` - Required, valid email format
- **Password**: `required,min=8,containsany=!@#$` - Required, minimum 8 characters with special characters

## CLI Options

- `-new-func`: Generate constructor with validation
- `-validation-func="validateField"`: Specify custom validation function name
- `-validation-tag="validate"`: Specify validation tag name

## Key Points

- Constructor returns `(*Account, error)` with validation
- All setters include error handling
- Private password setter maintains encapsulation
- Uses industry-standard go-playground/validator library
- Simple validation function delegates to validator.Var()
