# コーディング規約

## コメントとドキュメント

- コメントは英語で記述
- パブリックシンボルのgodocコメントは必須（テスト関数除外）
- 実装とコメントに乖離があったらコメントを修正
- パッケージのgodocコメントは`base.go`に記述

## 命名規則

- メンバメソッドのレシーバ名は型名の頭文字を使用（例：`User`型 → `u`）
- **プロジェクト固有**: `public/generator/Generator`が生成するコードのレシーバ名は`t`固定

## エラー処理

- エラー返却時は`errors.WithStack()`または`errors.Wrap()`/`errors.Wrapf()`でスタックトレース付与
- コンテキスト情報が必要な場合：`errors.Wrap()`/`errors.Wrapf()`
- コンテキスト情報が不要な場合：`errors.WithStack()`

## nilスライス・nilマップの扱い

- nilスライスは要素が0件のスライスと同一視する
- nilマップは要素が0件のマップと同一視する
- 初期化時や比較処理において、nilと空コレクションを区別しない

## コード生成・修正ガイドライン

- 共通化可能なコードは積極的に関数化
- 明確な指示が無い限り、実装コメントを含めない
- パブリックスコープのgodocコメントは必須
- 既存のコメントは削除せず維持
- コード内の空行はlinterエラー（特にwsl）が発生しない範囲で最小化
- nolintコメントの使用は最小限に抑制（使用時は理由を明記）

## 空行位置ルール

### 基本原則

- **`make format` で発生したエラーの修正は必須**
- `make format` によって再整形が生じない範囲で、以降に定めるルールを適用する
- 空行を２つ以上連続させることは禁止

### 宣言後の空行ルール

- 異なる種類の宣言（定数宣言、変数宣言、型宣言、インターフェース宣言、関数宣言）の間には空行が必要
- 型宣言と型宣言、インターフェース宣言とインターフェース宣言、関数宣言と関数宣言の間には空行が必要
- 宣言がブロック終端の場合には空行が不要

### 関数内の空行

- **`make format` の判断を最優先**
- 関数の開始直後・終了直前には空行不要。以降のすべての空行の有無を決定する時に考慮するべき最優先事項
- 論理的なブロック区切りでの空行は `make format` が再整形の対象とならない限り、任意

### 制御構文の空行

- return前には空行が必要
  - ただし、ブロック内に return 一文しか存在しない場合には空行が不要
- if の前には空行が必要
  - ただし、if の直前の行が変数への値の代入の場合には if の直前に空行が不要
  - ただし、その変数への値の代入の行の直前には空行が必要
  - ただし、その変数への値の代入の行が関数開始直後の場合には空行が不要
- for/switch前には空行が必要
- case/defaultの間には空行が必要
