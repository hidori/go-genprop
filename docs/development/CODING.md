# コーディング規約

## 作業時の必須チェック

- **コード変更前後に必ず行う**
  - `make format`を実行する
  - `make test`を実行する

## 基本方針

- コメントは英語で記述する
- **実装とコメントに乖離があった場合に必ず行う**
  - コメントを修正する
- 共通化可能なコードは積極的に関数化する
- 明確な指示が無い限り、実装コメントを含めない
- 既存のコメントは削除せず維持する

## 禁止事項

- コード内の空行はlinterエラー（特にwsl）が発生しない範囲で最小化する
- 空行を２つ以上連続させることは禁止する
- nolintコメントの使用は最小限に抑制する（使用時は理由を明記）

## 命名規則

### 変数・関数名

- メンバメソッドのレシーバ名は型名の頭文字を使用する（例：`User`型 → `u`）

### ファイル名

- 原則、パッケージ名と一致するファイル名を使用する
- テストファイル: `_test.go`
- モックファイル: `_mock.go`
- 例: `example/basic/user.go`, `example/private-setter/user.go`

## エラー処理

- **エラー返却時に必ず行う**
  - `errors.WithStack()`または`errors.Wrap()`/`errors.Wrapf()`でスタックトレースを付与する
- コンテキスト情報が必要な場合：`errors.Wrap()`/`errors.Wrapf()`を使用する
- コンテキスト情報が不要な場合：`errors.WithStack()`を使用する

## nilスライス・nilマップの扱い

- nilスライスは要素が0件のスライスと同一視する
- nilマップは要素が0件のマップと同一視する
- 初期化時や比較処理において、nilと空コレクションを区別しない

## コード品質

### 空行位置

#### 基本原則

- **`make format` で発生したエラーの修正は必須**
- `make format` によって再整形が生じない範囲で、以降に定めるルールを適用する

#### 宣言後の空行

- **異なる種類の宣言間には空行が必要**
  - 定数宣言、変数宣言、型宣言、インターフェース宣言、関数宣言の間
- **同じ種類の宣言間には空行が必要**
  - 型宣言と型宣言の間
  - インターフェース宣言とインターフェース宣言の間
  - 関数宣言と関数宣言の間
- 宣言がブロック終端の場合には空行を入れない

#### 関数内の空行

- **`make format` の判断を最優先とする**
- 関数の開始直後・終了直前には空行を入れない
  - この原則は以降のすべての空行の有無を決定する際の最優先事項とする
- 論理的なブロック区切りでの空行は `make format` が再整形の対象とならない限り任意とする

#### 制御構文の空行

- return前には空行が必要
  - ただし、ブロック内に return 一文しか存在しない場合には空行を入れない
- if の前には空行が必要
  - ただし、if の直前の行が変数への値の代入の場合には if の直前に空行を入れない
  - ただし、その変数への値の代入の行の直前には空行が必要
  - ただし、その変数への値の代入の行が関数開始直後の場合には空行を入れない
- for/switch前には空行が必要
- case/defaultの間には空行が必要

## プロジェクト固有

- `public/generator/Generator`が生成するコードのレシーバ名は`t`固定とする
