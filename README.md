# go-genprop

[![Go Version](https://img.shields.io/badge/Go-1.24+-00ADD8.svg)](https://golang.org)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](LICENSE)
[![Go Report Card](https://goreportcard.com/badge/github.com/hidori/go-genprop)](https://goreportcard.com/report/github.com/hidori/go-genprop)
[![CI](https://github.com/hidori/go-genprop/actions/workflows/check_and_test.yml/badge.svg?branch=main)](https://github.com/hidori/go-genprop/actions)

> **A powerful Go code generator that automatically creates getter and setter methods for struct fields using struct tags.**

Simplify your Go development with automatic property generation, validation support, and flexible configuration options.

## Features

- **Property Tag Support**: Use intuitive tags like `property:"get"`, `property:"set"`, `property:"get,set"`
- **Visibility Control**: Create private setters with `property:"set=private"`
- **Validation Integration**: Seamless integration with validation frameworks
- **Customizable Naming**: Smart initialism handling (ID, URL, API, JSON, etc.)
- **Error Handling**: Built-in error handling for validation failures
- **Zero Dependencies**: Works with Go standard library
- **High Performance**: Compile-time code generation

## Installation

```bash
go get -tool github.com/hidori/go-genprop/cmd/genprop@latest
```

or

```bash
docker pull hidori/genprop:latest
```

## Quick Start

### 1. Create your struct with property tags

```go
package basic

// User represents a basic user with ID and name.
type User struct {
    id   int    `property:"get"`     // Read-only ID field
    name string `property:"get,set"` // Name with both getter and setter
}

// NewUser creates a new User instance
func NewUser(id int, name string) *User {
    user := &User{id: id}
    user.SetName(name)
    return user
}
```

Example: [example/basic/user.go](example/basic/user.go)

### 2. Generate methods

```bash
go tool genprop user.go > user_generated.go
```

OUTPUT:

```go
// Code generated by github.com/hidori/go-genprop/cmd/genprop DO NOT EDIT.
package basic

func (t *User) GetID() int {
    return t.id
}
func (t *User) GetName() string {
    return t.name
}
func (t *User) SetName(v string) {
    t.name = v
}
```

Example: [example/basic/user_prop.go](example/basic/user_prop.go)

### 3. Use the generated methods

```go
// Create a new user using the constructor
user := NewUser(1, "John Doe")

// Access values using getters
fmt.Printf("User ID: %d\n", user.GetID())     // Output: User ID: 1
fmt.Printf("User Name: %s\n", user.GetName()) // Output: User Name: John Doe

// Update values using setters
user.SetName("Jane Smith")
fmt.Printf("Updated Name: %s\n", user.GetName()) // Output: Updated Name: Jane Smith
```

Example: [cmd/example/basic/main.go](cmd/example/basic/main.go)

## Usage

### CLI

#### Basic Commands

```bash
# Basic usage
go tool genprop input.go > output.go

# Custom validation function
go tool genprop -validation-func="myValidate" input.go > output.go

# Custom initialisms
go tool genprop -initialism="id,url,api,json,uuid" input.go > output.go

# Combine multiple options
go tool genprop -validation-func="validate" -initialism="id,api" input.go > output.go
```

#### Available Flags

```text
Usage: genprop [flags] <FILE>

A Go code generator that automatically creates getter and setter methods for private struct fields based on struct tags.

Flags:
  -initialism string
        specify names to which initialism should be applied (default "id,url,api")
  -validation-func string
        specify validation func name (default "validateFieldValue")
  -validation-tag string
        specify validation tag name (default "validate")
  -version
        show version information
```

### Docker

```bash
docker run --rm -v ${PWD}:${PWD} -w ${PWD} hidori/genprop:latest input.go > output.go
```

## Property Tag Reference

| Tag | Description | Example |
|-----|-------------|---------|
| `property:"get"` | Generate getter only | `GetName() string` |
| `property:"set"` | Generate setter only | `SetName(string)` |
| `property:"get,set"` | Generate both getter and setter | `GetName()`, `SetName(string)` |
| `property:"set=private"` | Generate private setter | `setName(string)` |

## Advanced Examples

### 1. Create struct with validation tags

```go
package example

import (
    "github.com/go-playground/validator/v10"
    "github.com/pkg/errors"
)

// User represents a user with validation-enabled fields.
type User struct {
    id       int    `property:"get"`                                   // Read-only ID field
    name     string `property:"get,set"`                              // Name with both getter and setter
    email    string `property:"get,set=private" validate:"required,email"` // Email with private setter and validation
}

var _validator = validator.New()

// NewUser creates a new User instance with validation.
func NewUser(id int, name, email string) (*User, error) {
    user := &User{id: id}

    user.SetName(name)

    if err := user.setEmail(email); err != nil {
        return nil, err
    }

    return user, nil
}

// validateFieldValue validates a field value using the specified validation tag.
func validateFieldValue(name string, v any, tag string) error {
    if err := _validator.Var(v, tag); err != nil {
        return errors.Wrapf(err, "validation failed for field '%s'", name)
    }
    return nil
}
```

Example: [example/advanced/user.go](example/advanced/user.go)

### 2. Generate validation methods

```bash
go tool genprop user.go > user_prop.go
```

OUTPUT:

```go
// Code generated by github.com/hidori/go-genprop/cmd/genprop DO NOT EDIT.
package advanced

func (t *User) GetID() int {
    return t.id
}
func (t *User) GetName() string {
    return t.name
}
func (t *User) SetName(v string) {
    t.name = v
}
func (t *User) GetEmail() string {
    return t.email
}
func (t *User) setEmail(v string) error {
    err := validateFieldValue("email", v, "required,email")
    if err != nil {
        return err
    }
    t.email = v
    return nil
}
```

Example: [example/advanced/user_prop.go](example/advanced/user_prop.go)

### 3. Use the generated methods with validation

```go
// Create a new user with validation
user, err := NewUser(1, "John Doe", "john@example.com")
if err != nil {
    log.Fatal(err)
}

// Access values using getters
fmt.Printf("User ID: %d\n", user.GetID())         // Output: User ID: 1
fmt.Printf("User Name: %s\n", user.GetName())     // Output: User Name: John Doe
fmt.Printf("User Email: %s\n", user.GetEmail())   // Output: User Email: john@example.com

// Update values using setters with validation
user.SetName("Jane Smith")

// Note: setEmail is private, so it can only be called from within the package
// This demonstrates validation with private setters for controlled access
```

Example: [cmd/example/advanced/main.go](cmd/example/advanced/main.go)

## Common Issues & Solutions

### Issue: "validateFieldValue function not found"

**Solution**: Make sure your validation function is defined in the same package:

```go
func validateFieldValue(name string, v any, tag string) error {
    // Your validation logic here
    return nil
}
```

### Issue: "Generated methods conflict with existing methods"

**Solution**: Rename your existing methods or exclude the field from code generation:

```go
// Option 1: Rename existing method
type User struct {
    name string `property:"get,set"`
}
func (u *User) GetUserName() string { /* existing method with different name */ }

// Option 2: Exclude field from generation
type User struct {
    name string `property:"-"` // Skip this field
}
func (u *User) GetName() string { /* your existing method */ }

// Option 3: Use only setter generation
type User struct {
    name string `property:"set"` // Only generate setter
}
func (u *User) GetName() string { /* your existing getter */ }
```

### Issue: "Initialism not working correctly"

**Solution**: Use the `-initialism` flag with comma-separated values:

```bash
go tool genprop -initialism="id,url,api,json,uuid,sql" input.go
```
